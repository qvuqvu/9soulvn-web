{"ast":null,"code":"import _objectSpread from\"C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{useDispatch,useSelector}from'react-redux';import{Form,Button}from'react-bootstrap';import{payOrder}from'../actions/orderActions';import{savePaymentMethod}from'../actions/cartActions';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';// for stripe CC component\nimport Message from'../components/Message';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckoutForm=function CheckoutForm(_ref){var price=_ref.price,orderID=_ref.orderID;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];// from the stripe component itself\nvar dispatch=useDispatch();var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),clientSecret=_useState4[0],setClientSecret=_useState4[1];// from the payment intent sent from server\nvar stripe=useStripe();var elements=useElements();var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;// STEP 1: create a payment intent and getting the secret\nuseEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios$post,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post('/api/orders/stripe-payment',{price:price,email:userInfo.email},{headers:{'Content-Type':'application/json'}});case 2:_yield$axios$post=_context.sent;data=_yield$axios$post.data;setClientSecret(data.clientSecret);case 5:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref2.apply(this,arguments);};}();if(userInfo&&price)getClientSecret();},[price,userInfo]);// STEP 2: make the payment after filling the form properly\nvar makePayment=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var payload;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:if(!clientSecret){_context2.next=10;break;}_context2.next=6;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement),billing_details:{name:userInfo.name,email:userInfo.email}}});case 6:payload=_context2.sent;// console.log(payload.error);\nif(!payload.error){dispatch(savePaymentMethod('Stripe'));dispatch(payOrder(orderID,_objectSpread(_objectSpread({},payload.paymentIntent),{},{paymentMode:'stripe'})));}else{setError(payload.error.message);}_context2.next=11;break;case 10:window.location.reload();case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function makePayment(_x){return _ref3.apply(this,arguments);};}();// render a checkout form for filling details about credit or debit cards\nreturn/*#__PURE__*/_jsxs(Form,{id:\"payment-form\",onSubmit:makePayment,children:[error&&/*#__PURE__*/_jsx(Message,{dismissible:true,variant:\"danger\",children:error}),/*#__PURE__*/_jsx(Form.Group,{style:{margin:'1em 0',fontSize:'1em'},children:/*#__PURE__*/_jsx(CardElement,{options:{style:{base:{fontSize:'16px',color:'#424770','::placeholder':{color:'#aab7c4'}},invalid:{color:'#9e2146'}}},id:\"card-element\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{disabled:!stripe,size:\"lg\",type:\"submit\",children:\"Pay Now\"})})]});};export default CheckoutForm;","map":{"version":3,"names":["React","useState","useEffect","axios","useDispatch","useSelector","Form","Button","payOrder","savePaymentMethod","CardElement","useStripe","useElements","Message","CheckoutForm","price","orderID","error","setError","dispatch","clientSecret","setClientSecret","stripe","elements","userLogin","state","userInfo","getClientSecret","post","email","headers","data","makePayment","e","preventDefault","confirmCardPayment","payment_method","card","getElement","billing_details","name","payload","paymentIntent","paymentMode","message","window","location","reload","margin","fontSize","style","base","color","invalid"],"sources":["C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/src/components/CheckoutForm.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Form, Button } from 'react-bootstrap';\r\nimport { payOrder } from '../actions/orderActions';\r\nimport { savePaymentMethod } from '../actions/cartActions';\r\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js'; // for stripe CC component\r\nimport Message from '../components/Message';\r\n\r\nconst CheckoutForm = ({ price, orderID }) => {\r\n\tconst [error, setError] = useState(''); // from the stripe component itself\r\n\tconst dispatch = useDispatch();\r\n\tconst [clientSecret, setClientSecret] = useState(''); // from the payment intent sent from server\r\n\tconst stripe = useStripe();\r\n\tconst elements = useElements();\r\n\r\n\tconst userLogin = useSelector((state) => state.userLogin);\r\n\tconst { userInfo } = userLogin;\r\n\r\n\t// STEP 1: create a payment intent and getting the secret\r\n\tuseEffect(() => {\r\n\t\tconst getClientSecret = async () => {\r\n\t\t\tconst { data } = await axios.post(\r\n\t\t\t\t'/api/orders/stripe-payment',\r\n\t\t\t\t{ price, email: userInfo.email },\r\n\t\t\t\t{\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tsetClientSecret(data.clientSecret);\r\n\t\t};\r\n\r\n\t\tif (userInfo && price) getClientSecret();\r\n\t}, [price, userInfo]);\r\n\r\n\t// STEP 2: make the payment after filling the form properly\r\n\tconst makePayment = async (e) => {\r\n\t\te.preventDefault();\r\n\t\tif (!stripe || !elements) {\r\n\t\t\t// Stripe.js has not yet loaded.\r\n\t\t\t// Make  sure to disable form submission until Stripe.js has loaded.\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (clientSecret) {\r\n\t\t\tconst payload = await stripe.confirmCardPayment(clientSecret, {\r\n\t\t\t\tpayment_method: {\r\n\t\t\t\t\tcard: elements.getElement(CardElement),\r\n\t\t\t\t\tbilling_details: {\r\n\t\t\t\t\t\tname: userInfo.name,\r\n\t\t\t\t\t\temail: userInfo.email,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\t// console.log(payload.error);\r\n\t\t\tif (!payload.error) {\r\n\t\t\t\tdispatch(savePaymentMethod('Stripe'));\r\n\t\t\t\tdispatch(\r\n\t\t\t\t\tpayOrder(orderID, {\r\n\t\t\t\t\t\t...payload.paymentIntent,\r\n\t\t\t\t\t\tpaymentMode: 'stripe',\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tsetError(payload.error.message);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\twindow.location.reload();\r\n\t\t}\r\n\t};\r\n\r\n\t// render a checkout form for filling details about credit or debit cards\r\n\treturn (\r\n\t\t<Form id='payment-form' onSubmit={makePayment}>\r\n\t\t\t{error && (\r\n\t\t\t\t<Message dismissible variant='danger'>\r\n\t\t\t\t\t{error}\r\n\t\t\t\t</Message>\r\n\t\t\t)}\r\n\t\t\t<Form.Group\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmargin: '1em 0',\r\n\t\t\t\t\tfontSize: '1em',\r\n\t\t\t\t}}>\r\n\t\t\t\t<CardElement\r\n\t\t\t\t\toptions={{\r\n\t\t\t\t\t\tstyle: {\r\n\t\t\t\t\t\t\tbase: {\r\n\t\t\t\t\t\t\t\tfontSize: '16px',\r\n\t\t\t\t\t\t\t\tcolor: '#424770',\r\n\t\t\t\t\t\t\t\t'::placeholder': {\r\n\t\t\t\t\t\t\t\t\tcolor: '#aab7c4',\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tinvalid: {\r\n\t\t\t\t\t\t\t\tcolor: '#9e2146',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tid='card-element'\r\n\t\t\t\t/>\r\n\t\t\t</Form.Group>\r\n\t\t\t<div className='d-grid'>\r\n\t\t\t\t<Button disabled={!stripe} size='lg' type='submit'>\r\n\t\t\t\t\tPay Now\r\n\t\t\t\t</Button>\r\n\t\t\t</div>\r\n\t\t</Form>\r\n\t);\r\n};\r\n\r\nexport default CheckoutForm;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}