{"ast":null,"code":"import _toConsumableArray from\"C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import Product from'../components/Product';import Paginate from'../components/Paginate';import{Row,Col}from'react-bootstrap';import ProductCarousel from'../components/ProductCarousel';import Meta from'../components/Meta';import{listProducts}from'../actions/productActions';import{refreshLogin,getUserDetails}from'../actions/userActions';import Message from'../components/Message';import SearchBox from'../components/SearchBox';import ProductSkeleton from'../components/ProductSkeleton';import Introduce from'../components/introduce';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var HomePage=function HomePage(_ref){var match=_ref.match,history=_ref.history;var keyword=match.params.keyword;// to search for products\nvar pageNumber=Number(match.params.pageNumber)||1;// current page number in the paginated display\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),promptVerfication=_useState2[0],setPromptVerification=_useState2[1];// prompt user to verify email if not yet confirmed\nvar _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),products=_useState4[0],setProducts=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),productAvailable=_useState6[0],setProductAvailable=_useState6[1];var dispatch=useDispatch();// get the products list, userinfo and user details form the redix store\nvar productList=useSelector(function(state){return state.productList;});var loading=productList.loading,error=productList.error,pages=productList.pages;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var userDetails=useSelector(function(state){return state.userDetails;});var userInfoError=userDetails.error;// fetch the user details\nuseEffect(function(){userInfo?userInfo.isSocialLogin?dispatch(getUserDetails(userInfo.id)):dispatch(getUserDetails('profile')):dispatch(getUserDetails('profile'));},[userInfo,dispatch]);// refresh token to get new access token if error in user details\nuseEffect(function(){if(userInfoError&&userInfo&&!userInfo.isSocialLogin){var user=JSON.parse(localStorage.getItem('userInfo'));dispatch(refreshLogin(user===null||user===void 0?void 0:user.email));}},[userInfoError,dispatch,userInfo]);// set a state variable to true or false depending on if products is avialable in the state\nuseEffect(function(){if(products){products.length?setProductAvailable(true):setProductAvailable(false);}},[products]);// fetch products from redux store into local state\nuseEffect(function(){if(productList){if(productList.products)setProducts(_toConsumableArray(productList.products));}},[productList]);// list products based on keyword and pagenumber\nuseEffect(function(){dispatch(listProducts(keyword,pageNumber));// eslint-disable-next-line react-hooks/exhaustive-deps\n},[dispatch,keyword,pageNumber]);// check if user needs to be promted about email verification on page load\nuseEffect(function(){setPromptVerification(localStorage.getItem('promptEmailVerfication')==='true'?true:false);},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Meta,{}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Introduce,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-block d-md-none\",children:/*#__PURE__*/_jsx(SearchBox,{history:history})}),promptVerfication?/*#__PURE__*/_jsx(Message,{dismissible:true,variant:\"info\",duration:10,children:\"Account Created! Please check your email to verify your account and start shopping.\"}):null,error?/*#__PURE__*/_jsx(Message,{dismissible:true,variant:\"danger\",duration:10,children:error}):!loading&&products?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Row,{children:products.length?products.map(function(product){return/*#__PURE__*/_jsx(Col,{sm:12,md:6,lg:4,xl:3,children:/*#__PURE__*/_jsx(Product,{product:product})},product._id);}):keyword&&!productAvailable&&/*#__PURE__*/ //   show this only if user has searched for some item and it is not available\n_jsxs(Col,{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"far fa-frown\"}),\" No items found for this search query\"]}),\"Go Back to the\",' ',/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"Home Page\"})]})}),/*#__PURE__*/_jsx(Paginate,{className:\"mt-auto text-center\",page:pageNumber,keyword:keyword?keyword:'',pages:pages})]}):loading&&products&&products.length===0&&/*#__PURE__*/_jsx(Row,{children:[1,2,3,4].map(function(ele){return/*#__PURE__*/_jsx(Col,{sm:12,md:6,lg:4,xl:3,children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(ProductSkeleton,{})})},ele);})})]});};export default HomePage;","map":{"version":3,"names":["React","useState","useEffect","Link","useDispatch","useSelector","Product","Paginate","Row","Col","ProductCarousel","Meta","listProducts","refreshLogin","getUserDetails","Message","SearchBox","ProductSkeleton","Introduce","HomePage","match","history","keyword","params","pageNumber","Number","promptVerfication","setPromptVerification","products","setProducts","productAvailable","setProductAvailable","dispatch","productList","state","loading","error","pages","userLogin","userInfo","userDetails","userInfoError","isSocialLogin","id","user","JSON","parse","localStorage","getItem","email","length","map","product","_id","ele"],"sources":["C:/Users/qvuqv/OneDrive/Documents/UIT/ecom2/MERN-Ecommerce/frontend/src/pages/HomePage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport Product from '../components/Product';\r\nimport Paginate from '../components/Paginate';\r\nimport { Row, Col } from 'react-bootstrap';\r\nimport ProductCarousel from '../components/ProductCarousel';\r\nimport Meta from '../components/Meta';\r\nimport { listProducts } from '../actions/productActions';\r\nimport { refreshLogin, getUserDetails } from '../actions/userActions';\r\nimport Message from '../components/Message';\r\nimport SearchBox from '../components/SearchBox';\r\nimport ProductSkeleton from '../components/ProductSkeleton';\r\nimport Introduce from '../components/introduce';\r\nconst HomePage = ({ match, history }) => {\r\n\tconst keyword = match.params.keyword; // to search for products\r\n\tconst pageNumber = Number(match.params.pageNumber) || 1; // current page number in the paginated display\r\n\tconst [promptVerfication, setPromptVerification] = useState(false); // prompt user to verify email if not yet confirmed\r\n\tconst [products, setProducts] = useState(null);\r\n\tconst [productAvailable, setProductAvailable] = useState(false);\r\n\tconst dispatch = useDispatch();\r\n\r\n\t// get the products list, userinfo and user details form the redix store\r\n\tconst productList = useSelector((state) => state.productList);\r\n\tlet { loading, error, pages } = productList;\r\n\r\n\tconst userLogin = useSelector((state) => state.userLogin);\r\n\tconst { userInfo } = userLogin;\r\n\r\n\tconst userDetails = useSelector((state) => state.userDetails);\r\n\tconst { error: userInfoError } = userDetails;\r\n\r\n\t// fetch the user details\r\n\tuseEffect(() => {\r\n\t\tuserInfo\r\n\t\t\t? userInfo.isSocialLogin\r\n\t\t\t\t? dispatch(getUserDetails(userInfo.id))\r\n\t\t\t\t: dispatch(getUserDetails('profile'))\r\n\t\t\t: dispatch(getUserDetails('profile'));\r\n\t}, [userInfo, dispatch]);\r\n\r\n\t// refresh token to get new access token if error in user details\r\n\tuseEffect(() => {\r\n\t\tif (userInfoError && userInfo && !userInfo.isSocialLogin) {\r\n\t\t\tconst user = JSON.parse(localStorage.getItem('userInfo'));\r\n\t\t\tdispatch(refreshLogin(user?.email));\r\n\t\t}\r\n\t}, [userInfoError, dispatch, userInfo]);\r\n\r\n\t// set a state variable to true or false depending on if products is avialable in the state\r\n\tuseEffect(() => {\r\n\t\tif (products) {\r\n\t\t\tproducts.length\r\n\t\t\t\t? setProductAvailable(true)\r\n\t\t\t\t: setProductAvailable(false);\r\n\t\t}\r\n\t}, [products]);\r\n\r\n\t// fetch products from redux store into local state\r\n\tuseEffect(() => {\r\n\t\tif (productList) {\r\n\t\t\tif (productList.products) setProducts([...productList.products]);\r\n\t\t}\r\n\t}, [productList]);\r\n\r\n\t// list products based on keyword and pagenumber\r\n\tuseEffect(() => {\r\n\t\tdispatch(listProducts(keyword, pageNumber));\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [dispatch, keyword, pageNumber]);\r\n\r\n\t// check if user needs to be promted about email verification on page load\r\n\tuseEffect(() => {\r\n\t\tsetPromptVerification(\r\n\t\t\tlocalStorage.getItem('promptEmailVerfication') === 'true'\r\n\t\t\t\t? true\r\n\t\t\t\t: false\r\n\t\t);\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Meta />\r\n\t\t\t<div><Introduce/></div>\r\n\t\t\t{/* display carousel only on larger screens */}\r\n\t\t\t{/* {!keyword ? (\r\n\t\t\t\twindow.innerWidth > 430 && <ProductCarousel />\r\n\t\t\t) : (\r\n\t\t\t\t<Link\r\n\t\t\t\t\tclassName='btn btn-outline btn-outline-primary my-2'\r\n\t\t\t\t\tto='/'>\r\n\t\t\t\t\tGo Back\r\n\t\t\t\t</Link>\r\n\t\t\t)} */}\r\n\t\t\t{/* display this search bar on home page on mobile screens */}\r\n\t\t\t<div className='d-block d-md-none'>\r\n\t\t\t\t<SearchBox history={history} />\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* if the user needs to be prompted about email verification, show this message */}\r\n\t\t\t{promptVerfication ? (\r\n\t\t\t\t<Message dismissible variant='info' duration={10}>\r\n\t\t\t\t\tAccount Created! Please check your email to verify your\r\n\t\t\t\t\taccount and start shopping.\r\n\t\t\t\t</Message>\r\n\t\t\t) : null}\r\n\r\n\t\t\t{error ? (\r\n\t\t\t\t<Message dismissible variant='danger' duration={10}>\r\n\t\t\t\t\t{error}\r\n\t\t\t\t</Message>\r\n\t\t\t) : !loading && products ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t{products.length\r\n\t\t\t\t\t\t\t? products.map((product) => {\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<Col\r\n\t\t\t\t\t\t\t\t\t\t\tsm={12}\r\n\t\t\t\t\t\t\t\t\t\t\tmd={6}\r\n\t\t\t\t\t\t\t\t\t\t\tlg={4}\r\n\t\t\t\t\t\t\t\t\t\t\txl={3}\r\n\t\t\t\t\t\t\t\t\t\t\tkey={product._id}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Product product={product} />\r\n\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t  })\r\n\t\t\t\t\t\t\t: keyword &&\r\n\t\t\t\t\t\t\t  !productAvailable && (\r\n\t\t\t\t\t\t\t\t\t//   show this only if user has searched for some item and it is not available\r\n\t\t\t\t\t\t\t\t\t<Col className='text-center'>\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<i className='far fa-frown' /> No\r\n\t\t\t\t\t\t\t\t\t\t\titems found for this search query\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\tGo Back to the{' '}\r\n\t\t\t\t\t\t\t\t\t\t<Link to='/'>Home Page</Link>\r\n\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t  )}\r\n\t\t\t\t\t</Row>\r\n\t\t\t\t\t<Paginate\r\n\t\t\t\t\t\tclassName='mt-auto text-center'\r\n\t\t\t\t\t\tpage={pageNumber}\r\n\t\t\t\t\t\tkeyword={keyword ? keyword : ''}\r\n\t\t\t\t\t\tpages={pages}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</>\r\n\t\t\t) : (\r\n\t\t\t\tloading &&\r\n\t\t\t\tproducts &&\r\n\t\t\t\tproducts.length === 0 && (\r\n\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t{[1, 2, 3, 4].map((ele) => {\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Col sm={12} md={6} lg={4} xl={3} key={ele}>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<ProductSkeleton />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Row>\r\n\t\t\t\t)\r\n\t\t\t)}\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport default HomePage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}